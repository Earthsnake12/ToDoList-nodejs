<!DOCTYPE HTML>

<html>

<head>
    <title>ListadoDiario</title>
    <link rel="stylesheet" type="text/css" href="estilo.css" />
    <script src="jquery-3.6.0.min.js"></script>
    <script src="tableSorter.js"></script>
    <script>

        $(function () {
            $("#lista").tablesorter();
            $('.error').hide();
        });

        function mostrarOcultarCampo(id) {
            let x = document.getElementById(id);
            if (x.style.display === "none") x.style.display = "block";
            else x.style.display = "none";
        }

        function focusCampo(id) {
            document.getElementById(id).focus();
        }

        //Pide nuevo registro para la fecha pasada
        function pedirFecha() {

            let fecha = $("#nuevaFecha").val();
            if (fecha == "") {
                $("#nuevaFechaError").show();
                $("#nuevaFecha").focus();
                return false;
            } 

            //tomar la fecha y pasarla a d/m/yyyy
            fecha = new Date(fecha);
            fecha.setDate(fecha.getDate() + 1)
            fecha = fecha.getDate() + "-" + (1 + fecha.getMonth()) + "-" + fecha.getFullYear();

            $.ajax({
                type: "POST",
                url: "listadoDiario?fecha=" + fecha,
                dataType: 'text',
                success: function (msj, textStatus, head) {

                    if (head.status === 200) {
                        location.reload();
                    }
                },
                error: function (xhr) {
                    alert(xhr.responseText);
                },
            });
        };

        //carga una nueva tarea en la fecha actual
        function cargaNuevaTarea() {
            $('.error').hide();
            
            var descripcion = $("#nuevaTareaDescripcion").val();
            if (descripcion == "") {
                $("#nuevaTareaDescripcionError").show();
                $("#nuevaTareaDescripcion").focus();
                return false;
            }

            //logica para enviar el formulario a /listadoDiario para procesarlo y cargarlo
            let fecha = $("#fecha").html();

            $.ajax({
                type: "POST",
                url: "listadoDiario/tarea?fecha=" + fecha,
                data: {
                    "descripcion": descripcion,
                    "ids": "-"
                },
                dataType: 'text',
                success: function (msj, textStatus, head) {

                    if (head.status === 200) {
                        location.reload();
                    }

                },
                error: function (xhr) {
                    alert(xhr.responseText);
                },
            });
        };
    </script>
</head>

<body>
    <nav>
        <a href="/listatarea">Listado de tareas</a>
        <a href="/listadoDiario?fecha=hoy">Listado diario</a>
    </nav>
    <div>
        <a href="/listatarea" style="visibility: hidden;">Listado de tareas</a>

        <div id="linksFechas"></div>
        <input type="date" id="nuevaFecha"><span class="error" id="nuevaFechaError"
    style="display: none">Campo requerido</span>
    <button type='Button' onClick="pedirFecha()">Pedir nuevo registro</button>
    </div>
    <h1></h1>
    <p id="fecha">00</p>
    

    <div id="lista">
        <h1>No se pudo cargar la Tabla</h1>
    </div>

    <button type='Button' onClick="mostrarOcultarCampo('divFormulario'), focusCampo('nuevaTareaTitulo')">Cargar nueva
        tarea</button>

    <div id="divFormulario" style="display: none">
        <h2>Nueva tarea</h2>

        <p>Descripcion: <textarea id="nuevaTareaDescripcion" style="width: 300px; height: 50px;"></textarea>
            <span class="error" id="nuevaTareaDescripcionError">Campo requerido</span>
        </p>

        <button type='Button' onClick="cargaNuevaTarea()">Subir</button>
        <p class="error" id="botonCargaNuevaTareaMsj">Tarea enviada</p>
    </div>

</body>

</html>