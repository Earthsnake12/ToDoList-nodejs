<!DOCTYPE HTML>

<html>

<head>
    <title>Tareas</title>
    <script src="jquery-3.6.0.min.js"></script>

    <style>
        p {
            margin: 0px;
        }
    </style>

    <script>

        function mostrarOcultarCampo(id) {
            let x = document.getElementById(id);
            if (x.style.display === "none") x.style.display = "block";
            else x.style.display = "none";
        }

        function focusCampo(id) {
            document.getElementById(id).focus();
        }

        function asignarValor(idOrigen, idObjetivo) {
            let contenido = document.getElementById(idOrigen).innerHTML;
            document.getElementById(idObjetivo).innerHTML = contenido;
        }

        function asignarValorCheckBox() {
            document.getElementById("inputactualizarImportante").checked = document.getElementById("importante").checked;
            document.getElementById("inputactualizarPrioritario").checked = document.getElementById("prioritario").checked;
        }

        function agregarAvance() {
            var avance = $("#inputNuevoAvance").val();
            if (avance == "") {
                $("#nuevaTareaEstadoError").show();
                $("#inputNuevoAvance").focus();
                return false;
            }

            tirarAjax("avance", avance);
        }

        function cambiarDescripcion() {
            var descripcion = $("#inputactualizarDescripcion").val();
            if (descripcion == "") {
                $("#actualizarDescripcionError").show();
                $("#inputactualizarDescripcion").focus();
                return false;
            }

            tirarAjax("descripcion", descripcion);
        }

        function tirarAjax(objetivo, valor){
            let id = $("#id").html();
            $.ajax({
                type: "PATCH",
                url: "/tarea?id=" + id,
                data: {
                    "objetivo": objetivo,
                    "valor" : valor
                },
                dataType: 'text',
                success: function (msj, textStatus, head) {
                    if (head.status === 200) {
                        location.reload();
                    } else {
                        alert(msj);
                    }

                },
                error: function (xhr) {
                    alert('Disculpe, hubo un problema');
                }
            })
        }
    </script>
</head>

<body>
    <nav>
        <a class="active" href="/index">Home</a>
        <a href="/uno">Uno</a>
        <a href="/dos">Dos</a>
        <a href="/tres">Tres</a>
    </nav>
    <h3></h3>
    <p id="id">00</p>
    <h2 id="titulo">Titulo</h2>

    <div>Estado: <span id="estado">Estado</span><span>&nbsp; &nbsp; &nbsp;</span>
        <button type='Button' onclick="asignarValorCheckBox(), mostrarOcultarCampo('imp-pri'),
            mostrarOcultarCampo('actualizarEstado'), focusCampo('inputactualizarEstado')">M</button>
    </div>
    <div id="imp-pri">
        <span>Importante:</span> <input type="checkbox" id="importante" onclick="return false;">
        <span>&nbsp; &nbsp; &nbsp;</span>
        <span>Prioritario:</span> <input type="checkbox" id="prioritario" onclick="return false;">
    </div>

    <div id="actualizarEstado" style="display: none">Nuevo Estado:
        <input type="text" id="inputactualizarEstado" style="width: 250px;">
        <p>
            <span>Importante: <input type="checkbox" id="inputactualizarImportante"></span>
            <span>&nbsp; &nbsp; &nbsp;</span>
            <span>Prioritario: <input type="checkbox" id="inputactualizarPrioritario"></span>
            <button type='Button'>Actualizar</button>
        </p>
    </div>

    <h3></h3>

    <div>Descripcion: </div>
    <div id="descripcion">descripcion</div>
    <button type='Button'
        onclick="asignarValor('descripcion', 'inputactualizarDescripcion'), mostrarOcultarCampo('actualizarDescripcion'), focusCampo('inputactualizarDescripcion')">M</button>

    <div id="actualizarDescripcion" style="display: none">Nueva Descripcion:
        <p><textarea id="inputactualizarDescripcion" style="width: 500px;">AA</textarea></p>
        <button type='Button' onClick="cambiarDescripcion()">Actualizar</button> 
        <span class="error" id="actualizarDescripcionError" style="display: none">Campo requerido</span>
    </div>

    <h3></h3>

    <div id="avances"> Avances:

    </div>
    <p id="nuevoAvance" style="display: none">Nuevo avance: <input type="text" id="inputNuevoAvance">
        <button type='Button' onClick="agregarAvance()">Agregar avance</button>
        <span class="error" id="nuevaTareaEstadoError" style="display: none">Campo requerido</span>
    </p>
    <h3></h3>
    <button type='Button' onClick="mostrarOcultarCampo('nuevoAvance'), focusCampo('inputNuevoAvance')">Agregar nuevo avance</button>
</body>

</html>